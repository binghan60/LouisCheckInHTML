<!DOCTYPE html>
<html lang="zh-TW">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="Â§ßÂÆ∂ÈÉΩÂ•ΩÊ£í" />
        <title>Âä†Áè≠Ë≤ªË®àÁÆóÂô®</title>
        <!-- Vue CDN -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.min.js"></script>
        <!-- SheetJS for Excel -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
        <!-- Chart.js -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <style>
            :root {
                --primary-color: #4a90e2;
                --success-color: #2ecc71;
                --danger-color: #ff4d4f;
                --warning-color: #f39c12;
                --secondary-color: #9b59b6;
                --bg-color: #f8f9fa;
                --card-bg: #ffffff;
                --text-main: #333333;
                --text-muted: #666666;
                --border-color: #e0e0e0;
            }

            * {
                box-sizing: border-box;
                font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            }

            body {
                margin: 0;
                padding: 20px;
                background-color: var(--bg-color);
                color: var(--text-main);
                line-height: 1.6;
            }

            .container {
                max-width: 1100px;
                margin: 20px auto;
                background-color: var(--card-bg);
                padding: 30px;
                border-radius: 12px;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            }

            h1 {
                text-align: center;
                color: var(--text-main);
                margin-top: 0;
                margin-bottom: 30px;
                font-size: 2.2em;
                font-weight: 700;
            }

            /* --- Controls --- */
            .controls {
                display: flex;
                flex-direction: column;
                gap: 20px;
                margin-bottom: 30px;
                padding: 20px;
                background-color: #fcfcfc;
                border: 1px solid var(--border-color);
                border-radius: 8px;
            }

            .month-selector {
                display: flex;
                align-items: center;
                flex-wrap: wrap;
                justify-content: center;
                gap: 12px;
            }

            .form-input {
                padding: 10px 14px;
                border: 1px solid var(--border-color);
                border-radius: 6px;
                font-size: 14px;
                transition: border-color 0.2s, box-shadow 0.2s;
                background-color: white;
            }

            .form-input:focus {
                outline: none;
                border-color: var(--primary-color);
                box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
            }

            .month-radio-group {
                display: flex;
                flex-wrap: wrap;
                gap: 8px;
                justify-content: center;
                background-color: #f1f3f5;
                padding: 5px;
                border-radius: 8px;
            }

            .month-radio-input {
                display: none;
            }

            .month-radio-label {
                padding: 8px 16px;
                cursor: pointer;
                border-radius: 6px;
                font-size: 14px;
                font-weight: 600;
                color: var(--text-muted);
                transition: all 0.2s;
                background-color: transparent;
                border: 1px solid transparent;
            }

            .month-radio-label:hover {
                background-color: rgba(255, 255, 255, 0.5);
                color: var(--primary-color);
            }

            .month-radio-input:checked + .month-radio-label {
                background-color: white;
                color: var(--primary-color);
                box-shadow: 0 2px 5px rgba(0,0,0,0.05);
                border-color: #e9ecef;
            }
            
            .month-radio-input:disabled + .month-radio-label {
                cursor: not-allowed;
                opacity: 0.6;
            }

            /* --- Table Design --- */
            .table-container {
                overflow-x: auto;
                margin-bottom: 25px;
                border-radius: 8px;
                border: 1px solid var(--border-color);
                max-height: 600px;
            }

            table {
                width: 100%;
                border-collapse: collapse;
                border: none;
            }

            th {
                background-color: #fdfdfd;
                font-weight: 600;
                color: var(--text-muted);
                text-transform: uppercase;
                font-size: 0.85em;
                letter-spacing: 0.5px;
                position: sticky;
                top: 0;
                z-index: 10;
                border-bottom: 2px solid var(--border-color);
            }

            th, td {
                padding: 12px 10px;
                text-align: center;
                border-bottom: 1px solid var(--border-color);
            }

            tbody tr {
                transition: background-color 0.2s;
            }

            tbody tr:hover {
                background-color: #f9fbff !important;
            }

            .holiday {
                background-color: #fff8f8;
            }
            
            .weekend-row {
                background-color: #fcfcfc;
            }

            .time-input {
                width: 130px;
                text-align: center;
                border: 1px solid #ddd;
                border-radius: 4px;
                padding: 6px;
            }

            .holiday-toggle-btn {
                width: 54px;
                height: 26px;
                border-radius: 13px;
                border: 1px solid var(--border-color);
                background-color: #eeeeee;
                color: #777;
                font-size: 12px;
                font-weight: bold;
                cursor: pointer;
                transition: all 0.3s;
                position: relative;
            }

            .holiday-toggle-btn.active {
                background-color: var(--danger-color);
                color: white;
                border-color: var(--danger-color);
            }

            /* --- Action Buttons --- */
            .action-buttons {
                display: flex;
                justify-content: space-between;
                margin-top: 30px;
                flex-wrap: wrap;
                gap: 15px;
            }

            .button-group-left {
                display: flex;
                gap: 12px;
                align-items: center;
            }

            .action-btn {
                padding: 12px 24px;
                border: none;
                border-radius: 6px;
                cursor: pointer;
                font-weight: 600;
                font-size: 15px;
                transition: all 0.2s;
                display: flex;
                align-items: center;
                justify-content: center;
                text-decoration: none;
            }

            .save-btn {
                background-color: var(--success-color);
                color: white;
                box-shadow: 0 2px 8px rgba(46, 204, 113, 0.2);
            }

            .save-btn:hover {
                background-color: #27ae60;
                transform: translateY(-1px);
                box-shadow: 0 4px 12px rgba(46, 204, 113, 0.3);
            }

            .import-btn {
                background-color: white;
                color: var(--primary-color);
                border: 1px solid var(--primary-color);
            }

            .import-btn:hover {
                background-color: #f0f7ff;
            }

            .template-btn {
                background-color: white;
                color: var(--secondary-color);
                border: 1px solid var(--secondary-color);
            }

            /* --- Summary & Charts Section --- */
            .summary {
                margin-top: 35px;
                padding: 25px;
                background: linear-gradient(135deg, #ffffff 0%, #f9f9f9 100%);
                border: 1px solid var(--border-color);
                border-radius: 12px;
                display: flex;
                flex-direction: column;
            }

            .summary-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                border-bottom: 1px solid #eee;
                margin-bottom: 20px;
                padding-bottom: 10px;
            }

            .summary h3 {
                margin: 0;
                color: var(--text-main);
                font-size: 1.3em;
            }

            .summary-stats {
                display: flex;
                gap: 40px;
                margin-bottom: 20px;
            }

            .summary p {
                margin: 0;
                font-size: 1.1rem;
                color: var(--text-muted);
            }

            .summary p span {
                font-weight: 700;
                color: var(--primary-color);
                font-size: 1.2em;
                margin-left: 10px;
            }

            .charts-row {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 20px;
                margin-top: 20px;
            }

            .chart-box {
                background: white;
                padding: 15px;
                border-radius: 8px;
                border: 1px solid #f0f0f0;
            }

            .chart-box h4 {
                margin-top: 0;
                margin-bottom: 15px;
                font-size: 1rem;
                color: var(--text-muted);
                text-align: center;
            }

            .chart-container {
                position: relative;
                height: 280px;
                width: 100%;
            }

            /* --- Toasts & Loaders --- */
            .loading-overlay {
                backdrop-filter: blur(4px);
                background-color: rgba(255, 255, 255, 0.7);
            }

            .loader {
                filter: invert(1);
            }

            /* --- RWD Media Queries --- */
            @media (max-width: 992px) {
                .charts-row { grid-template-columns: 1fr; }
            }

            @media (max-width: 768px) {
                .container { padding: 20px; }
                .action-buttons { flex-direction: column; }
                .button-group-left { flex-direction: column; width: 100%; }
                .action-btn { width: 100%; }
                .summary-stats { flex-direction: column; gap: 10px; }
            }
        </style>
    </head>
    <body>
        <div id="app" v-cloak>
            <div class="container">
                <h1>Âä†Áè≠Ë≤ªË®àÁÆóÂô®</h1>
                <div class="controls">
                    <div class="month-selector">
                        <label for="year">Âπ¥‰ªΩ:</label>
                        <select class="form-input" id="year" v-model="selectedYear" @change="loadMonthData" :disabled="formLock">
                            <option v-for="year in yearOptions" :key="year" :value="year">{{ year }}Âπ¥</option>
                        </select>
                    </div>
                    
                    <div class="month-radio-group">
                        <template v-for="month in 12" :key="month">
                            <input 
                                type="radio" 
                                :id="`month-${month}`" 
                                :value="month" 
                                v-model="selectedMonth" 
                                class="month-radio-input"
                                @change="loadMonthData"
                                :disabled="formLock"
                            >
                            <label :for="`month-${month}`" class="month-radio-label">{{ month }}Êúà</label>
                        </template>
                    </div>

                    <div class="month-selector">
                        <label for="username">ÂßìÂêç:</label>
                        <input class="form-input" style="color: gray; background-color: #f5f5f5;" type="text" id="username" v-model="username" disabled />
                        <label for="salary">Êú¨ÊúàËñ™Ë≥á:</label>
                        <input class="form-input" type="text" id="salary" placeholder="Ë´ãËº∏ÂÖ•ÊúàËñ™" v-model="salary" @input="updateAllOvertimeCalculations" autocomplete="off" :disabled="formLock" />
                    </div>
                </div>

                <div class="summary">
                    <div class="summary-header">
                        <h3>Êú¨ÊúàÁµ±Ë®àËàáÂàÜÊûêË∂®Âã¢</h3>
                        <div class="summary-stats">
                            <p>Á∏ΩÂä†Áè≠ÊôÇÊï∏<span>{{ totalOvertimeHours.toFixed(2) }} Â∞èÊôÇ</span></p>
                            <p>Á∏ΩÂä†Áè≠Ë≤ª‰º∞ÁÆó<span>$ {{ totalOvertimePay.toLocaleString(undefined, {maximumFractionDigits: 0}) }} ÂÖÉ</span></p>
                        </div>
                    </div>
                    
                    <div class="charts-row">
                        <div class="chart-box">
                            <h4>üìÖ {{ selectedMonth }} ÊúàÊØèÊó•Âä†Áè≠Ëµ∞Âã¢</h4>
                            <div class="chart-container">
                                <canvas id="dailyChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-box">
                            <h4>üìà {{ selectedYear }} Âπ¥Â∫¶Âä†Áè≠Ë∂®Âã¢</h4>
                            <div class="chart-container">
                                <canvas id="yearlyChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="table-container">
                    <table id="overtime-table">
                        <thead>
                            <tr>
                                <th>Êó•Êúü</th>
                                <th>ÊòüÊúü</th>
                                <th>ÁãÄÊÖã</th>
                                <th>‰∏äÁè≠</th>
                                <th>‰∏ãÁè≠</th>
                                <th>Â∑•ÊôÇ</th>
                                <th>Âä†Áè≠ÊôÇÊï∏</th>
                                <th>Âä†Áè≠Ë≤ª</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="(entry, index) in monthData" :key="entry.date" 
                                :class="{ holiday: entry.isHoliday, 'weekend-row': entry.weekday === 'ÂÖ≠' || entry.weekday === 'Êó•' }">
                                <td style="font-weight: 500;">{{ entry.date.slice(5) }}</td>
                                <td :style="{ color: entry.isHoliday ? 'var(--danger-color)' : 'inherit' }">{{ entry.weekday }}</td>
                                <td>
                                    <button class="holiday-toggle-btn" @click="toggleHoliday(index)" :class="{ active: entry.isHoliday }" :disabled="formLock">
                                        {{ entry.isHoliday ? '‰ºë' : '‰∏ä' }}
                                    </button>
                                </td>
                                <td>
                                    <input type="time" class="time-input form-input" v-model="entry.startTime" @change="updateTimeAndCalculate(index, 'startTime', entry.startTime)" :disabled="formLock" />
                                </td>
                                <td>
                                    <input type="time" class="time-input form-input" v-model="entry.endTime" @change="updateTimeAndCalculate(index, 'endTime', entry.endTime)" :disabled="formLock" />
                                </td>
                                <td><span style="color: #888;">{{ entry.isHoliday ? 1 : 9 }}</span></td>
                                <td style="font-weight: 600; color: var(--primary-color);">{{ entry.overtimeHours > 0 ? entry.overtimeHours.toFixed(2) : '-' }}</td>
                                <td style="font-weight: 700; color: var(--warning-color);">{{ entry.overtimePay > 0 ? '$' + entry.overtimePay.toFixed(0) : '-' }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="action-buttons">
                    <div class="button-group-left">
                        <label for="excel-file-input" class="action-btn import-btn" :disabled="formLock">
                            <span>üìÇ ÂåØÂÖ• Excel</span>
                        </label>
                        <input type="file" id="excel-file-input" accept=".xlsx, .xls" @change="handleExcelImport" style="display: none;" :disabled="formLock" />
                        <a v-if="!formLock" href="https://louis-check-in-html.vercel.app/excelDemo.xlsx" target="_blank" class="action-btn template-btn">
                            <span>üìÑ ÁØÑÊú¨‰∏ãËºâ</span>
                        </a>
                        <div id="import-status" :class="importStatusClass" style="font-size: 0.9em;">{{ importStatus }}</div>
                    </div>

                    <button class="action-btn save-btn" @click="saveData" :disabled="formLock">
                        <span>üíæ ÂÑ≤Â≠òÊú¨ÊúàË≥áÊñô</span>
                    </button>
                </div>
            </div>

            <div class="loading-overlay" :style="{ display: loading ? 'flex' : 'none' }">
                <div class="loader"></div>
            </div>
            <div class="toast-container">
                <div v-for="(toast, index) in toasts" :key="index" :class="`toast toast-${toast.type}`">{{ toast.message }}</div>
            </div>
        </div>

        <script>
            const apipath = 'https://louis-check-in-html.vercel.app/api';
            const weekdayNames = ['Êó•', '‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠'];

            const { createApp, ref, computed, onMounted, nextTick, watch } = Vue;

            const app = createApp({
                setup() {
                    const selectedYear = ref(new Date().getFullYear());
                    const selectedMonth = ref(new Date().getMonth() + 1);
                    const monthData = ref([]);
                    const username = ref('');
                    const salary = ref('0');
                    const loading = ref(false);
                    const importStatus = ref('');
                    const importStatusClass = ref('');
                    const toasts = ref([]);
                    const userId = ref('');
                    const chartInstances = ref({});

                    const yearOptions = computed(() => {
                        const currentYear = new Date().getFullYear();
                        const startYear = currentYear - 1;
                        const endYear = currentYear + 3;
                        const years = [];
                        for (let i = startYear; i <= endYear; i++) { years.push(i); }
                        return years;
                    });

                    const totalOvertimeHours = computed(() => monthData.value.reduce((sum, entry) => sum + (entry.overtimeHours || 0), 0));
                    const totalOvertimePay = computed(() => monthData.value.reduce((sum, entry) => sum + (entry.overtimePay || 0), 0));
                    const formLock = ref(false);

                    function getDaysInMonth(year, month) { return new Date(year, month, 0).getDate(); }

                    function createEmptyMonthData(year, month) {
                        const daysInMonth = getDaysInMonth(year, month);
                        const data = [];
                        for (let day = 1; day <= daysInMonth; day++) {
                            const date = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                            const dayDate = new Date(year, month - 1, day);
                            const weekday = weekdayNames[dayDate.getDay()];
                            data.push({
                                date: date, weekday: weekday, isHoliday: weekday === 'ÂÖ≠' || weekday === 'Êó•',
                                startTime: '', endTime: '', overtimeHours: 0, overtimePay: 0,
                            });
                        }
                        return data;
                    }

                    function loadMonthData() {
                        loading.value = true;
                        fetch(`${apipath}/overtime?userId=${userId.value}&year=${selectedYear.value}&month=${selectedMonth.value}`)
                            .then(res => res.json())
                            .then(data => {
                                salary.value = data.salary || 0;
                                const dataMap = {};
                                if (data.data) { data.data.forEach(item => { dataMap[item.date] = item; }); }
                                const newMonthData = createEmptyMonthData(selectedYear.value, selectedMonth.value);
                                newMonthData.forEach((entry, index) => {
                                    if (dataMap[entry.date]) {
                                        newMonthData[index] = { ...entry, ...dataMap[entry.date], isHoliday: dataMap[entry.date].isHoliday !== undefined ? dataMap[entry.date].isHoliday : entry.isHoliday };
                                    }
                                });
                                monthData.value = newMonthData;
                                updateAllOvertimeCalculations();
                            })
                            .catch(() => { monthData.value = createEmptyMonthData(selectedYear.value, selectedMonth.value); })
                                                        .finally(() => {
                                                            loading.value = false;
                                                            // Á¢∫‰øù DOM Êõ¥Êñ∞ÂæåÂÜçÁπ™Ë£ΩÂúñË°®
                                                            nextTick(() => {
                                                                updateChartData();
                                                            });
                                                        });
                                                }

                    function loadProfileData() {
                        const urlParams = new URLSearchParams(window.location.search);
                        userId.value = urlParams.get('id');
                        if (!userId.value) { formLock.value = true; showToast('ÁôºÁîüÈåØË™§', 'error'); return; }
                        fetch(`${apipath}/user?id=${userId.value}`)
                            .then(res => res.json())
                            .then(userData => { username.value = userData.username || ''; })
                            .catch(() => { showToast('ËºâÂÖ•‰ΩøÁî®ËÄÖË≥áÊñôÊôÇÁôºÁîüÈåØË™§', 'error'); });
                    }

                    function getBaseHourlyRate() { return (parseFloat(salary.value) || 0) / 30 / 8; }

                    function calculateSingleRow(index) {
                        const entry = monthData.value[index];
                        if (entry && entry.startTime && entry.endTime) {
                            const baseDate = '2000-01-01T';
                            const start = new Date(baseDate + entry.startTime);
                            let end = new Date(baseDate + entry.endTime);
                            if (end < start) end.setDate(end.getDate() + 1);
                            const totalWorkHours = (end - start) / 3600000;
                            const normalHours = entry.isHoliday ? 1 : 9;
                            const overtime = Math.max(0, totalWorkHours - normalHours);
                            const rate = getBaseHourlyRate();
                            entry.overtimeHours = overtime;
                            entry.overtimePay = overtime > 0 ? (Math.min(2, overtime) * rate * 1.33 + Math.max(0, overtime - 2) * rate * 1.66) : 0;
                        } else if (entry) {
                            entry.overtimeHours = 0; entry.overtimePay = 0;
                        }
                    }

                    function updateAllOvertimeCalculations() {
                        monthData.value.forEach((_, i) => calculateSingleRow(i));
                    }

                    function updateTimeAndCalculate(index, field, value) {
                        monthData.value[index][field] = value;
                        calculateSingleRow(index);
                        updateChartData(); // Âç≥ÊôÇÊõ¥Êñ∞ÂúñË°®
                    }

                    function toggleHoliday(index) {
                        monthData.value[index].isHoliday = !monthData.value[index].isHoliday;
                        calculateSingleRow(index);
                        updateChartData();
                    }

                    // --- Charts Logic ---
                    function updateChartData() {
                        fetch(`${apipath}/overtime/summary?userId=${userId.value}&year=${selectedYear.value}`)
                            .then(res => res.json())
                            .then(yearlyStats => {
                                nextTick(() => renderCharts(yearlyStats));
                            });
                    }

                    function renderCharts(yearlyStats) {
                        const dailyCtx = document.getElementById('dailyChart');
                        if (dailyCtx) {
                            if (chartInstances.value.daily) {
                                chartInstances.value.daily.destroy();
                                chartInstances.value.daily = null;
                            }
                            const days = monthData.value.map(d => d.date.slice(8));
                            const hours = monthData.value.map(d => d.overtimeHours || 0);
                            const pay = monthData.value.map(d => Math.round(d.overtimePay || 0));
                            
                            // Ê™¢Êü•ÊòØÂê¶ÊúâÊï∏ÊìöÔºåÈÅøÂÖçÂÖ®Á©∫ÂúñË°® (ÂèØÈÅ∏)
                            
                            chartInstances.value.daily = new Chart(dailyCtx, {
                                type: 'bar',
                                data: {
                                    labels: days,
                                    datasets: [
                                        { label: 'ÊôÇÊï∏', data: hours, backgroundColor: 'rgba(74, 144, 226, 0.6)', yAxisID: 'y' },
                                        { label: 'Âä†Áè≠Ë≤ª', data: pay, type: 'line', borderColor: '#f39c12', yAxisID: 'y1', tension: 0.1 }
                                    ]
                                },
                                options: { 
                                    responsive: true, 
                                    maintainAspectRatio: false, 
                                    animation: false, // ÈóúÈñâÂãïÁï´‰ª•ÈÅøÂÖçÈ†ªÁπÅÊõ¥Êñ∞ÊôÇÁöÑÈñÉÁàç
                                    scales: { y: { beginAtZero: true, position: 'left' }, y1: { beginAtZero: true, position: 'right', grid: { drawOnChartArea: false } } } 
                                }
                            });
                        }

                        const yearlyCtx = document.getElementById('yearlyChart');
                        if (yearlyCtx) {
                            if (chartInstances.value.yearly) {
                                chartInstances.value.yearly.destroy();
                                chartInstances.value.yearly = null;
                            }
                            const months = ['1Êúà', '2Êúà', '3Êúà', '4Êúà', '5Êúà', '6Êúà', '7Êúà', '8Êúà', '9Êúà', '10Êúà', '11Êúà', '12Êúà'];
                            const yHours = yearlyStats.map(s => s.totalHours || 0);
                            const yPay = yearlyStats.map(s => Math.round(s.totalPay || 0));
                            
                            chartInstances.value.yearly = new Chart(yearlyCtx, {
                                type: 'bar',
                                data: {
                                    labels: months,
                                    datasets: [
                                        { label: 'ÊúàÁ∏ΩÊôÇÊï∏', data: yHours, backgroundColor: 'rgba(46, 204, 113, 0.5)', yAxisID: 'y' },
                                        { label: 'ÊúàÁ∏ΩÈáëÈ°ç', data: yPay, type: 'line', borderColor: '#9b59b6', yAxisID: 'y1', tension: 0.3 }
                                    ]
                                },
                                options: { 
                                    responsive: true, 
                                    maintainAspectRatio: false, 
                                    animation: false,
                                    scales: { y: { beginAtZero: true, position: 'left' }, y1: { beginAtZero: true, position: 'right', grid: { drawOnChartArea: false } } } 
                                }
                            });
                        }
                    }

                    function saveData() {
                        loading.value = true;
                        fetch(`${apipath}/overtime`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ userId: userId.value, year: selectedYear.value, month: selectedMonth.value, data: monthData.value.filter(e => e.startTime || e.endTime || e.isHoliday), salary: salary.value }),
                        })
                        .then(() => showToast('Â≠òÊ™îÊàêÂäüÔºÅ'))
                        .catch(() => showToast('Â≠òÊ™îÂ§±ÊïóÔºÅ', 'error'))
                        .finally(() => { loading.value = false; updateChartData(); });
                    }

                    function showToast(message, type = 'success') {
                        const toast = { message, type };
                        toasts.value.push(toast);
                        setTimeout(() => { toasts.value = toasts.value.filter(t => t !== toast); }, 3000);
                    }

                    function handleExcelImport(event) {
                        const file = event.target.files[0];
                        if (!file) return;
                        const reader = new FileReader();
                        reader.onload = e => { processExcelData(new Uint8Array(e.target.result)); };
                        reader.readAsArrayBuffer(file);
                    }

                    function processExcelData(data) {
                        try {
                            const workbook = XLSX.read(data, { type: 'array', cellDates: true });
                            const jsonData = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]], { header: 1, raw: false, dateNF: 'yyyy-mm-dd hh:mm:ss' });
                            jsonData.slice(1).forEach(row => {
                                let dateValue = row[0];
                                let targetDateStr = null;
                                if (dateValue instanceof Date && dateValue.getFullYear() === selectedYear.value && dateValue.getMonth() + 1 === selectedMonth.value) {
                                    targetDateStr = `${selectedYear.value}-${String(selectedMonth.value).padStart(2, '0')}-${String(dateValue.getDate()).padStart(2, '0')}`;
                                }
                                if (targetDateStr) {
                                    const idx = monthData.value.findIndex(e => e.date === targetDateStr);
                                    if (idx !== -1) {
                                        monthData.value[idx].startTime = formatTime(row[1]);
                                        monthData.value[idx].endTime = formatTime(row[2]);
                                        calculateSingleRow(idx);
                                    }
                                }
                            });
                            showToast('Excel ÂåØÂÖ•ÂÆåÊàê');
                            updateChartData();
                        } catch (e) { showToast('Ëß£ÊûêÂ§±Êïó', 'error'); }
                    }

                    function formatTime(v) {
                        if (!v) return '';
                        if (v instanceof Date) return `${String(v.getHours()).padStart(2, '0')}:${String(v.getMinutes()).padStart(2, '0')}`;
                        return v;
                    }

                    onMounted(() => { loadProfileData(); loadMonthData(); });

                    return { selectedYear, selectedMonth, monthData, username, salary, loading, importStatus, importStatusClass, toasts, yearOptions, totalOvertimeHours, totalOvertimePay, formLock, loadMonthData, updateTimeAndCalculate, saveData, handleExcelImport, toggleHoliday };
                },
            });

            app.mount('#app');
        </script>
    </body>
</html>
